<template>
  <v-container class="fill-height">
    <v-responsive class="d-flex text-center fill-height">
      <v-row class="d-flex align-center justify-center">
        <v-col cols="auto">
          <svg
            width="199"
            height="82"
            viewBox="0 0 199 82"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M30.1444 51.872C21.3757 43.1111 20.2834 29.5701 26.8827 19.6179C36.8348 13.0283 50.3823 14.114 59.1511 22.875C67.9198 31.6359 68.9969 45.1769 62.4128 55.1291C58.1346 57.964 53.2041 59.3814 48.2736 59.3814C41.7046 59.3814 35.1356 56.8783 30.1444 51.872ZM0 41C0 63.6337 18.3567 82 41.0219 82C63.672 82 82.0439 63.6488 82.0439 41C82.0439 18.3512 63.672 0 41.0219 0C18.3567 0 0 18.3512 0 41Z"
              fill="url(#paint0_radial_774_10400)"
            />
            <path
              d="M29.8562 15.8029C28.6122 17.0394 27.5047 18.3814 26.5793 19.7989C36.5921 13.2093 50.2306 14.295 59.0601 23.0559C67.8895 31.832 68.9818 45.373 62.337 55.3251C63.763 54.3902 65.098 53.3045 66.3572 52.0681C76.4307 42.0556 76.4307 25.8154 66.3572 15.8029C61.3205 10.7966 54.7212 8.29352 48.1219 8.29352C41.5074 8.27845 34.8929 10.7966 29.8562 15.8029Z"
              fill="url(#paint1_linear_774_10400)"
            />
            <path
              d="M184.718 17.8916C176.823 17.8916 170.435 24.1887 170.435 31.9709V50.0305C170.435 57.8127 176.823 64.1098 184.718 64.1098C192.612 64.1098 199 57.8127 199 50.0305V31.9709C199 24.159 192.612 17.8916 184.718 17.8916ZM188.755 50.0305C188.755 52.2285 186.947 54.0107 184.688 54.0107C182.458 54.0107 180.65 52.2285 180.65 50.0305V31.9709C180.65 29.7729 182.458 27.961 184.688 27.961C186.917 27.961 188.725 29.7432 188.755 31.9709V50.0305Z"
              fill="#1369B0"
            />
            <path
              d="M146.371 17.8916C144.862 17.8916 143.294 18.1291 141.815 18.6634C138.177 19.9101 135.337 22.5817 133.799 25.8173C132.882 27.717 132.379 29.7949 132.379 31.9916C132.379 33.5055 132.645 35.0787 133.148 36.5629L137.319 48.7334C137.467 49.1787 137.526 49.5943 137.526 50.0395C137.526 50.6332 137.378 51.2566 137.112 51.7909C136.668 52.7111 135.899 53.4532 134.834 53.8094C134.39 53.9578 133.976 54.0172 133.533 54.0172C133.355 54.0172 133.148 53.9875 132.941 53.9578L132.349 53.8688V64.0504L132.852 64.0801C133.089 64.0801 133.296 64.1098 133.533 64.1098C135.041 64.1098 136.579 63.8723 138.088 63.338C141.756 62.0913 144.566 59.4197 146.134 56.2138C147.051 54.314 147.554 52.2065 147.554 50.0395C147.554 48.5256 147.318 46.9524 146.785 45.4682L142.614 33.2977C142.466 32.8524 142.407 32.4368 142.407 31.9916C142.407 31.3682 142.555 30.7745 142.821 30.2402C143.294 29.2903 144.034 28.5779 145.099 28.2217C145.543 28.0733 145.957 28.0139 146.401 28.0139C146.578 28.0139 146.785 28.0436 146.963 28.0733L147.584 28.192V18.0103L147.081 17.9807C146.815 17.9213 146.578 17.8916 146.371 17.8916Z"
              fill="#1369B0"
            />
            <path
              d="M165.78 17.8916C165.75 17.8916 165.75 17.8916 165.72 17.8916C161.79 17.8916 158.193 19.4659 155.594 22.0203C153.025 24.5451 151.392 28.1095 151.392 31.9709V50.0305C151.392 53.8919 153.025 57.4563 155.594 59.981C158.133 62.5058 161.7 64.0801 165.569 64.1098H165.69C166.506 64.1098 167.322 64.0504 168.078 63.9019L168.531 63.8424V53.0305L167.715 53.5057C167.11 53.8622 166.445 54.0404 165.69 54.0404C164.541 54.0404 163.574 53.5949 162.818 52.882C162.062 52.1394 161.639 51.1889 161.639 50.0602V32.0006C161.639 30.8719 162.093 29.9214 162.818 29.1788C163.574 28.4362 164.541 28.0204 165.69 28.0204C166.445 28.0204 167.141 28.1986 167.715 28.5551L168.531 29.0006V18.1886L168.078 18.0995C167.382 17.9807 166.597 17.8916 165.78 17.8916Z"
              fill="#1369B0"
            />
            <path
              d="M128.541 17.8916H117.115V64.1098H128.541V17.8916Z"
              fill="#1369B0"
            />
            <path
              d="M94.2632 27.961H98.7578V64.1098H108.812V27.961H113.306V17.8916H94.2632V27.961Z"
              fill="#1369B0"
            />
            <defs>
              <radialGradient
                id="paint0_radial_774_10400"
                cx="0"
                cy="0"
                r="1"
                gradientUnits="userSpaceOnUse"
                gradientTransform="translate(62.6279 11.0013) rotate(124.415) scale(76.4568 75.7421)"
              >
                <stop stop-color="#36C4FF" />
                <stop offset="1" stop-color="#114F97" />
              </radialGradient>
              <linearGradient
                id="paint1_linear_774_10400"
                x1="48.4722"
                y1="16.8688"
                x2="64.5734"
                y2="-1.71762"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#ED1C24" />
                <stop offset="1" stop-color="#82060B" />
              </linearGradient>
            </defs>
          </svg>
        </v-col>
      </v-row>
      <v-row class="d-flex align-center justify-center">
        <v-col cols="auto">
          <h2 style="color: #1783dc">การยืนยันตัวตน</h2>
          <br />
          <h4>ระบบได้ส่ง SMS รหัส OTP ไปยัง</h4>
          <h4>
            เบอร์มือถือ <b>{{ phoneNo }}</b>
          </h4>
          <br />
          <h4>
            รหัสอ้างอิง : <b>{{ otp }}</b>
          </h4>
        </v-col>
      </v-row>
      <v-row class="d-flex align-center justify-center">
        <v-col cols="auto">
          <v-sheet class="d-flex flex-wrap">
            <v-sheet class="ma-0 pa-0">
              <div
                style="width: 100%; display: flex; ustify-content: space-around"
              >
                <input
                  v-model="n1"
                  @change="onChange()"
                  v-on:keyup="onKeyup('n2', $event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />&nbsp;&nbsp;
                <input
                  v-model="n2"
                  ref="n2"
                  @change="onChange()"
                  v-on:keyup="onKeyup('n3', $event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />&nbsp;&nbsp;
                <input
                  v-model="n3"
                  ref="n3"
                  @change="onChange()"
                  v-on:keyup="onKeyup('n4', $event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />&nbsp;&nbsp;
                <input
                  v-model="n4"
                  ref="n4"
                  @change="onChange()"
                  v-on:keyup="onKeyup('n5', $event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />&nbsp;&nbsp;
                <input
                  v-model="n5"
                  ref="n5"
                  @change="onChange()"
                  v-on:keyup="onKeyup('n6', $event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />&nbsp;&nbsp;
                <input
                  v-model="n6"
                  ref="n6"
                  @change="onChange()"
                  v-on:keyup="onKeyupOtpfinish($event)"
                  style="
                    height: 2.5em;
                    width: 2em;
                    border: 2px solid #dad9df;
                    outline: none;
                    text-align: center;
                    font-size: 1.5em;
                    border-radius: 0.3em;
                  "
                  type="text"
                  maxlength="1"
                  class="input"
                  minlength="1"
                  :maxlength="1"
                  min="0"
                  max="9"
                />
              </div>
            </v-sheet>
          </v-sheet>
        </v-col>
      </v-row>
      <v-row class="d-flex align-center justify-center">
        <v-col cols="auto">
          <!-- btn select -->
          <v-btn
            ref="btnFn"
            variant="outlined"
            color="primary"
            :disabled="disabledValue"
            v-on:click="this.$router.push('/')"
          >
            ยืนยัน
          </v-btn>

          <!-- btn select -->
        </v-col>
      </v-row>
      <v-row class="d-flex align-center justify-center">
        <v-col cols="auto">
          <br />
          <h4>หากไม่ได้รับรหัส OTP</h4>
          <h4 style="color: red">
            กรุณารอ 56 วินาที เพื่อกดขอรับรหัส OTP ใหม่
          </h4>
        </v-col>
      </v-row>
    </v-responsive>
  </v-container>
</template>

<script>
import axios from 'axios';
import liff from '@line/liff';

export default {
  data() {
    return {
      value: [0, 100],
      phoneNo: localStorage.getItem('phoneNo'),
      otp: Math.floor(Math.random() * 999999),
      n1: '',
      n2: '',
      n3: '',
      n4: '',
      n5: '',
      n6: '',
      disabledValue: true,
    };
  },
  async created() {},
  methods: {
    async onChange() {
      let number =
        '' + this.n1 + this.n2 + this.n3 + this.n4 + this.n5 + this.n6;
      if (this.otp == number) {
        this.disabledValue = false;
        let req = '';
        const headers = {
          'Content-Type': 'application/json',
        };
        req = {
          token:
            'Bearer eVzQQbp6xcKhc9LNPSPwf3K1TgQ8Fp6Hgi8FKl8o4WSQNWrpJF7V5/suwjESd74m/0LtwWgThB7xNzvDfQCJ5eYKj6Ibu0OumCE69To5/PTEHrlG9o3S8sGCHTLhfviMPQsQFExdMWaKqD5l5f8EjAdB04t89/1O/w1cDnyilFU=',
          userId: localStorage.getItem('profileId'),
          data: {
            to: [localStorage.getItem('profileId')],
            messages: [
              {
                type: 'text',
                text: 'สวัสดีค่ะ ยินดีต้อนรับค่ะ',
              },
              {
                type: 'text',
                text: 'สถานะของคุณอยู่ในขั้นตอนข้างล่างนี้',
              },
              {
                type: 'image',
                originalContentUrl:
                  'https://sbu-laal-laml.s3.ap-southeast-1.amazonaws.com/api/AAA.png',
                previewImageUrl:
                  'https://sbu-laal-laml.s3.ap-southeast-1.amazonaws.com/api/AAA.png',
              },
              {
                type: 'text', // ①
                text: 'คุณลูกค้าต้องการให้แจ้งหากมีการเปลี่ยนสถานะหรือไม่ค่ะ!',
                quickReply: {
                  // ②
                  items: [
                    {
                      type: 'action',
                      action: {
                        type: 'message',
                        label: 'ต้องการ',
                        text: 'ต้องการแจ้งผลการเปลี่ยนสถานะ',
                      },
                    },
                    {
                      type: 'action', // ④
                      action: {
                        type: 'message',
                        label: 'ไม่ต้องการ',
                        text: 'ยกเลิกการเตือน',
                      },
                    },
                  ],
                },
              },
            ],
          },
        };

        await axios
          .post('https://d3uc9t7bjwxv55.cloudfront.net/api/sendLineMsg', req, {
            headers,
          })
          .then((response) => response.data);

        await liff.closeWindow();
        await liff.logout();
        await window.close();
      }
    },
    onKeyup(n, event) {
      if (event) {
        if (!Number.isInteger(+event.target.value)) {
          if (n == 'n2') {
            this.n1 = '';
          } else if (n == 'n3') {
            this.n2 = '';
          } else if (n == 'n4') {
            this.n3 = '';
          } else if (n == 'n5') {
            this.n4 = '';
          } else if (n == 'n6') {
            this.n5 = '';
          }
        } else {
          if (n == 'n2') this.$refs.n2.focus();
          if (n == 'n3') this.$refs.n3.focus();
          if (n == 'n4') this.$refs.n4.focus();
          if (n == 'n5') this.$refs.n5.focus();
          if (n == 'n6') this.$refs.n6.focus();
        }
      }
    },
    onKeyupOtpfinish(event) {
      if (event) {
        if (!Number.isInteger(+event.target.value)) {
          this.n6 = '';
        } else {
          this.$refs.n6.blur();
        }
      }
    },
    onInput(event) {
      this.n1 = event.target.value;
    },
  },
};
</script>
